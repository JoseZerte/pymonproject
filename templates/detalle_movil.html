{% extends 'base.html' %}

{% block content %}
<style>
    /* Estilos para las estrellas */
    .rate {
        float: left;
        height: 46px;
        padding: 0 10px;
    }
    .rate:not(:checked) > input {
        position:absolute;
        top:-9999px;
    }
    .rate:not(:checked) > label {
        float:right;
        width:1em;
        overflow:hidden;
        white-space:nowrap;
        cursor:pointer;
        font-size:30px;
        color:#ccc;
    }
    .rate:not(:checked) > label:before {
        content: '★ ';
    }
    .rate > input:checked ~ label {
        color: #ffc700;
    }
    .rate:not(:checked) > label:hover,
    .rate:not(:checked) > label:hover ~ label {
        color: #deb217;
    }
    .rate > input:checked + label:hover,
    .rate > input:checked + label:hover ~ label,
    .rate > input:checked ~ label:hover,
    .rate > input:checked ~ label:hover ~ label,
    .rate > label:hover ~ input:checked ~ label {
        color: #c59b08;
    }
</style>

<div class="container mt-4">
    <div class="row">
        <div class="col-md-5">
            <div class="card shadow border-0">
                <img src="{{ movil.imgURL }}" class="card-img-top p-4" alt="{{ movil.name }}">
                <div class="card-body">
                    <h2 class="card-title">{{ movil.name }}</h2>
                    <h3 class="text-warning fw-bold">{{ movil.price }} €</h3>
                    </div>
            </div>

            <div class="card mt-3 shadow-sm border-warning">
                <div class="card-header bg-warning text-dark fw-bold">
                    <i class="bi bi-bookmark-plus"></i> Guardar en mis listas
                </div>
                <div class="card-body">
                    {% if mis_listas %}
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="btn_ranking" value="true">
                            <label class="form-label">Elige una lista:</label>
                            <div class="input-group">
                                <select name="ranking_seleccionado" class="form-select">
                                    {% for lista in mis_listas %}
                                        <option value="{{ lista.id }}">{{ lista.nombre }}</option>
                                    {% endfor %}
                                </select>
                                <button type="submit" class="btn btn-dark">Guardar</button>
                            </div>
                        </form>
                    {% else %}
                        <p class="small text-muted">No tienes listas creadas.</p>
                        <a href="{% url 'mis_rankings' %}" class="btn btn-sm btn-outline-dark w-100">Crear una lista ahora</a>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-7">
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">Tu Valoración</h5>
                </div>
                <div class="card-body">
                    {% if ya_votado %}
                        <div class="alert alert-success">
                            <i class="bi bi-check-circle-fill"></i> Ya has valorado este móvil.
                        </div>
                    {% else %}
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="btn_votar" value="true">

                            <div class="mb-3">
                                <label>Puntuación:</label><br>
                                <div class="rate">
                                    <input type="radio" id="star5" name="rating" value="5" />
                                    <label for="star5" title="text">5 stars</label>
                                    <input type="radio" id="star4" name="rating" value="4" />
                                    <label for="star4" title="text">4 stars</label>
                                    <input type="radio" id="star3" name="rating" value="3" />
                                    <label for="star3" title="text">3 stars</label>
                                    <input type="radio" id="star2" name="rating" value="2" />
                                    <label for="star2" title="text">2 stars</label>
                                    <input type="radio" id="star1" name="rating" value="1" />
                                    <label for="star1" title="text">1 star</label>
                                </div>
                                <div style="clear:both;"></div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Tu opinión:</label>
                                <textarea name="comentario" class="form-control" rows="3" required></textarea>
                            </div>

                            <button type="submit" class="btn btn-primary w-100">Enviar Opinión</button>
                        </form>
                    {% endif %}
                </div>
            </div>

            <h4>Comentarios</h4>
            <div class="list-group">
                {% for val in valoraciones %}
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1 fw-bold">{{ val.user_email }}</h6>
                            <small class="text-muted">{{ val.fecha|date:"d/m/Y" }}</small>
                        </div>
                        <div class="text-warning">
                            {% if val.puntuacion >= 1 %}★{% endif %}
                            {% if val.puntuacion >= 2 %}★{% endif %}
                            {% if val.puntuacion >= 3 %}★{% endif %}
                            {% if val.puntuacion >= 4 %}★{% endif %}
                            {% if val.puntuacion == 5 %}★{% endif %}
                        </div>
                        <p class="mb-1">{{ val.comentario }}</p>
                    </div>
                {% empty %}
                    <div class="alert alert-light">Sin comentarios.</div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}